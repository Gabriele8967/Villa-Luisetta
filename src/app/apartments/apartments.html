<div class="apartments-container">
  <!-- Navigation Unificata -->
  <app-navigation></app-navigation>

  <main class="main-content">
    <!-- Hero Section Rinnovata -->
    <section class="hero-showcase">
      <div class="hero-content">
        <h1 class="hero-title">
          <span class="title-line">{{ 'apartments.hero.title.line1' | i18n }}</span>
          <span class="title-line highlight">{{ 'apartments.hero.title.line2' | i18n }}</span>
        </h1>
        <p class="hero-description">
          <span>{{ 'apartments.hero.description' | i18n }}</span>
        </p>
        <div class="hero-stats">
          <div class="stat-item">
            <span class="stat-number">6</span>
            <span class="stat-label">{{ 'apartments.hero.stat.label' | i18n }}</span>
          </div>
        </div>
      </div>
      <div class="hero-visual">
      </div>
    </section>

    <!-- Apartments Showcase -->
    <section class="apartments-showcase">
      <div class="showcase-header">
        <h2 class="section-title">{{ 'apartments.showcase.title' | i18n }}</h2>
      </div>

      <div class="apartments-masonry">
        <div class="apartment-tile" 
             *ngFor="let apartment of apartments; let i = index"
             [style.animation-delay.ms]="i * 150">
          
          <!-- Apartment Card -->
          <div class="tile-content">
            
            <!-- Main Info -->
            <div class="tile-header">
              <div class="room-type" [class]="getRoomTypeClass(apartment.id)">
                {{ getRoomType(apartment.id) }}
              </div>
              <div class="price-badge">
                <span class="price-amount">{{ apartment.price }}</span>
              </div>
            </div>

            <!-- Room Image Carousel -->
            <div class="tile-image-carousel" (click)="openImageModal(apartment)">
              <div class="carousel-container">
                <img [src]="getCurrentImage(apartment)" 
                     [alt]="'Stanza ' + apartment.name + ' a Villa Luisetta - ' + apartment.size" 
                     class="room-image" 
                     loading="lazy"
                     decoding="async"
                     [style.background-color]="'#f0f0f0'">
                
                <!-- Carousel Navigation -->
                <button class="carousel-btn carousel-btn-prev" 
                        (click)="prevImage(apartment.id, $event)"
                        *ngIf="apartment.images.length > 1"
                        [attr.aria-label]="'Immagine precedente di stanza ' + apartment.name"
                        type="button">
                  <span class="carousel-arrow" aria-hidden="true">‹</span>
                </button>
                <button class="carousel-btn carousel-btn-next" 
                        (click)="nextImage(apartment.id, $event)"
                        *ngIf="apartment.images.length > 1"
                        [attr.aria-label]="'Immagine successiva di stanza ' + apartment.name"
                        type="button">
                  <span class="carousel-arrow" aria-hidden="true">›</span>
                </button>
                
                <!-- Image Counter -->
                <div class="image-counter" *ngIf="apartment.images.length > 1">
                  {{ getCarouselIndex(apartment.id) + 1 }} / {{ apartment.images.length }}
                </div>
                
                <!-- Click indicator -->
                <div class="click-indicator">
                  <span class="indicator-icon">🔍</span>
                  <span class="indicator-text" i18n="@@apartments.image.click.hint">Clicca per vedere tutte le foto</span>
                </div>
              </div>
            </div>

            <div class="tile-body">
              <h3 class="apartment-title">{{ apartment.name }}</h3>
              <p class="apartment-size">{{ apartment.size }}</p>
            </div>


            <!-- Action Footer -->
            <div class="tile-footer">
              <button class="contact-btn-main" 
                    (click)="scrollToContact()"
                    [attr.aria-label]="'Contatta Villa Luisetta per prenotare la stanza ' + apartment.name">
                <span class="btn-text">{{ 'apartments.contact.button' | i18n }}</span>
                <span class="btn-arrow" aria-hidden="true">📞</span>
              </button>
            </div>

          </div>


        </div>
      </div>
    </section>

    <!-- Call to Action -->
    <section class="cta-section">
      <div class="cta-content">
        <h2 class="cta-title">{{ 'apartments.cta.title' | i18n }}</h2>
        <p class="cta-description">
          <span>{{ 'apartments.cta.description' | i18n }}</span>
        </p>
        <div class="cta-actions">
          <a href="mailto:{{ contactInfo.email }}" class="cta-btn primary">
            <span class="cta-icon">✉</span>
            <span>{{ 'apartments.cta.email' | i18n }}</span>
          </a>
          <a href="tel:+393247829723" class="cta-btn secondary">
            <span class="cta-icon">📞</span>
            <span>{{ 'apartments.cta.phone' | i18n }}</span>
          </a>
        </div>
      </div>
      <div class="cta-decoration">
        <div class="decoration-circle"></div>
        <div class="decoration-line"></div>
      </div>
    </section>

  </main>

  <!-- Image Modal -->
  <div class="image-modal" 
       *ngIf="showModal" 
       (click)="closeModal()"
       (keydown)="onModalKeydown($event)"
       tabindex="0">
    <div class="modal-overlay"></div>
    
    <div class="modal-content" (click)="$event.stopPropagation()">
      <!-- Modal Header -->
      <div class="modal-header">
        <h3 class="modal-title">{{ modalRoomName }}</h3>
        <button class="modal-close" (click)="closeModal()">
          <span>✕</span>
        </button>
      </div>
      
      <!-- Modal Image -->
      <div class="modal-image-container">
        <img [src]="modalImages[modalCurrentIndex]" 
             [alt]="'Stanza ' + modalRoomName + ' a Villa Luisetta'" 
             class="modal-image"
             loading="lazy"
             decoding="async">
        
        <!-- Modal Navigation -->
        <button class="modal-nav-btn modal-prev" 
                (click)="prevModalImage()"
                *ngIf="modalImages.length > 1">
          <span class="nav-arrow">‹</span>
        </button>
        <button class="modal-nav-btn modal-next" 
                (click)="nextModalImage()"
                *ngIf="modalImages.length > 1">
          <span class="nav-arrow">›</span>
        </button>
        
        <!-- Modal Counter -->
        <div class="modal-counter" *ngIf="modalImages.length > 1">
          <span i18n="@@apartments.modal.counter" [innerHTML]="getModalCounterText()"></span>
        </div>
      </div>
      
      <!-- Modal Footer -->
      <div class="modal-footer" *ngIf="modalImages.length > 1">
        <div class="modal-thumbnails">
          <div class="thumbnail" 
               *ngFor="let image of modalImages; let i = index"
               [class.active]="i === modalCurrentIndex"
               (click)="modalCurrentIndex = i">
            <img [src]="image" [alt]="'Stanza ' + modalRoomName" loading="lazy" decoding="async">
          </div>
        </div>
      </div>
    </div>
  </div>
</div>